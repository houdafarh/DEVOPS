pipeline {
   environment {
registry = "houdafarh/timesheetp"
registryCredential = 'DockerCredentials'
dockerImage = '' }
    agent any
stages {
stage("Cloning Project from Git") {
steps { 
git branch: 'Houda', credentialsId: 'GitCredentials', url: 'https://github.com/houdafarh/DEVOPS.git'
}
}
stage("Build") {
steps {
dir("TimesheetProject"){
bat "mvn compile"}
}}
stage("Clean- Package"){
steps {
dir("TimesheetProject"){
bat "mvn clean package -DskipTests"}
}}
stage('Docker : Build image') {
steps {
   dir("TimesheetProject"){
script {
   dockerImage = docker.build registry + ":$BUILD_NUMBER"}}}}
stage('Docker : Push image') {
steps {
   dir("TimesheetProject"){
script {
docker.withRegistry( '', registryCredential ) {
   dockerImage.push()}}}}}
stage('Cleaning up') {
steps {
   dir("TimesheetProject"){
sh "docker rmi $registry:$BUILD_NUMBER"}}}
}
}
