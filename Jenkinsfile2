pipeline {
   environment {
registry = "houdafarh/timesheet"
registryCredential = 'DockerCredentials'
dockerImage = '' }
    agent any
stages {
stage("Cloning Project from Git") {
steps { 
git branch: 'Houda', credentialsId: 'GitCredentials', url: 'https://github.com/houdafarh/DEVOPS.git'
}
}
stage("Build") {
steps {
dir("TimesheetProject"){
bat "mvn compile"}
}}
stage("Unit tests") {
steps {
dir("TimesheetProject"){
bat "mvn test"}
}}
stage("Clean- Package"){
steps {
dir("TimesheetProject"){
bat "mvn clean package"}
}}
}
stage('Docker : Build image') {
steps {
script {
dockerImage = docker.build registry}}}
stage('Docker : Push image') {
steps {
script {
docker.withRegistry( '', registryCredential ) {
dockerImage.push()}}}}
}
